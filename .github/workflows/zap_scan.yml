name: DAST Scan

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  zap_scan:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Run ZAP Baseline Scan
        id: zap
        uses: zaproxy/action-baseline@v0.12.0
        with:
          target: "https://example.com" # Change to your target URL
          rules_file_name: ""
          cmd_options: "-a"
        continue-on-error: true

      - name: Ensure report is in workspace
        run: |
          mkdir -p zap-results
          if [ -f report_html.html ]; then
            mv report_html.html zap-results/zap-report.html
          elif [ -f zap-report.html ]; then
            mv zap-report.html zap-results/zap-report.html
          elif [ -f owasp-zap-scan-report.html ]; then
            mv owasp-zap-scan-report.html zap-results/zap-report.html
          else
            echo "⚠️ No report file found, creating empty report."
            echo "<html><body><h1>No ZAP Report Generated</h1></body></html>" > zap-results/zap-report.html
          fi

      - name: Upload ZAP Report
        uses: actions/upload-artifact@v4
        with:
          name: zap-report
          path: zap-results/zap-report.html
